---
- name: Palo initial config
  hosts: palo
  connection: local
  # ignore_errors: true
  roles:
    - dsu.ccdc.palo
  vars:
    provider:
      ip_address: "{{ inventory_hostname }}"
      api_key: "{{ api_key }}"

    palo_update_os: true
    palo_config_initial_interface: true
    palo_config_initial_zones: true
    palo_config_initial_rules: true
    palo_config_logging: true
    palo_config_initial_groups: true
    palo_config_update_other: true

  tasks:
    - name: Include role
      ansible.builtin.include_role:
        name: dsu.ccdc.palo
        vars_from: main.yml

    - name: Load vars
      ansible.builtin.include_vars:
        dir: /home/ansible/vars/

    - name: Print configs
      ansible.builtin.debug:
        msg:
          PANOS Version: "{{ palo_panos_version | default(omit) }}"
          FW Net: "{{ lan_net | default(omit) }}"
          Wazuh: "{{ wazuh | default(omit) }}"
          Wazuh Port: "{{ wasuh_port | default(omit) }}"

    - name: Create decryption rule
      when: palo_config_initial_rules
      ansible.builtin.import_role:
        name: dsu.ccdc.palo
        tasks_from: decryption
